<body>
    <div class="modal fade" id="modalEdit" tabindex="-1" role="dialog" aria-labelledby="myModalEdit" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->
                    <h4 class="modal-title" id="myModalEdit">Edit Customer Information</h4>
                </div>
                <div class="modal-body">

                    <div class="row d-flex justify-content-center">

                        <div class="col-md-6">
                            <img id="cusfaceEdit" />
                        </div>

                        <div class="col-md-6">
                            <p id="cusnameEdit"></p>
                            <p id="cusphoneEdit"></p>
                            <p id="cusaddressEdit"></p>
                        </div>
                    </div>

                    <div>
                        <label for="customerNameEdit">Name</label>
                        <input type="text" class="form-control" name="cName" id="customerNameEdit"
                            placeholder="Enter new name">
                        <div>
                            <label for="customerPhoneEdit">Phone</label>
                            <input type="text" class="form-control" name="cPhone" id="customerPhoneEdit"
                                placeholder="Enter new phone number">
                        </div>

                        <div>
                            <label for="customerAddressEdit">Address</label>
                            <input type="text" class="form-control" name="cAddress" id="customerAddressEdit"
                                placeholder="Enter new address">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="container-fluid">
                        <div class="row d-flex justify-content-center">
                            <button type="button" class="btn btn-primary" id="btndonedit">Done</button>

                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="container">
        <div class="container-fluid">
            <br>

            <div class="input-group">

                <input type="text" id="findname" name="findname" placeholder="Enter customer name"><br><br>
                <!-- class="input-group-addon">Search</span> -->
                <button class="btn btn-default input-group-addon" onclick="searchCustomerByName()">Search</button>
            </div>

            <br>

            <div class="row d-flex justify-content-center">
                <h4>List customers</h4>
                <br>
                <table style="margin: 15px;" class="table table-striped" id="tablecustomer" width="100%"
                    cellpadding="10">

                    <!-- <thead>
                        <th id="noc">Cus. Id</th>
                        <th>Cus. Name</th>
                        <th id="noc">Age</th>
                        <th>Cus. Address</th>
                        <th>Cus. Phone</th>
                        <th>Img</th>
                        <th>Option</th>
                    </thead> -->
                    <tbody id="tablecusbody">

                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        var customers = [];
        var clickid;
        $(document).ready(function () {

            var fetchData = JSON.parse('{{cusdata}}'.replace(/&#34;/g, "\""));
            insertTable(fetchData);

        });
        function searchCustomerByName() {

            var name = document.getElementById("findname").value;
            if (name == null || name == "") {
                alert("You should enter customer name first!")
            }
            else {
                $.ajax({
                    url: "http://0.0.0.0:8855/searchcustomerbyname",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        "cusname": name
                    }),
                    success: function (data) {
                        insertTable(JSON.parse(data.replace(/&#34;/g, "\"")));
                    }
                });
            }

        }
        function insertTable(fetchData) {
            customers = []
            $("#tablecusbody").empty();
            // var pos = 0;
            for (c of fetchData) {
                // c.position = pos;

                customers.push(c);
                var age = getAgeSpan(c.cage) + " years old";
                var name = c.cname;
                var id = c.id;
                var phone = "Phone: " + c.cphone;
                var address = c.caddress;

                var srce = "data:image/jpeg;base64," + c.faceimg;
                var newImage = document.createElement('img');
                newImage.src = srce;
                newImage.width = newImage.height = "40";
                $("#tablecustomer tbody").append(
                    '<tr>' + '<td class="nr" id="noc">' + id + '</td>'
                    + '<td>' + name + '</td>'
                    + '<td>' + age + '</td>'
                    + '<td>' + address + '</td>'
                    + '<td>' + phone + '</td>'
                    + '<td><img src=' + newImage.src + ' height="40" width="40" /></td>'
                    + '<td><button type="button" class="btn btn-primary bshow" onclick="edit(this)" ' +
                    'height="30" width="40">Edit</button>'

                    + '</tr>'
                )
            }
        }
        function edit(obj) {
            var $row = $(obj).closest('tr');    // tim dong chua civialian
            clickid = $row.find('.nr').text(); // thu tu dong 
            var cimage, cage;
            var cname = cid = cPhone = caddress = "";
            for (c of customers) {
                if (c.id == clickid) {
                    cimage = c.faceimg;
                    cage = c.cage;

                    cid = c.id;
                    cname = c.cname;
                    cPhone = c.cphone;
                    caddress = c.caddress;
                    break;
                }
            }
            var srce = "data:image/jpeg;base64," + cimage;
            var newImage = document.createElement('img');
            newImage.src = srce;
            document.getElementById('cusfaceEdit').src = newImage.src;
            $('#cusnameEdit').show();
            $('#cusphoneEdit').show();
            $('#cusaddressEdit').show();
            $('#cusnameEdit').text("Name: " + cname);
            $('#cusphoneEdit').text("Phone: " + cPhone);
            $('#cusaddressEdit').text("Address: " + caddress);
            $("#modalEdit").modal("show");
        }
        function getAgeSpan(age) {
            if (age >= 10 && age <= 15) {
                return "10-15";
            }
            else if (age >= 16 && age <= 20) {
                return "16-20";
            }
            else if (age >= 21 && age <= 25) {
                return "21-25";
            }
            else if (age >= 26 && age <= 30) {
                return "26-30";
            }
            else if (age >= 31 && age <= 35) {
                return "31-35";
            }
            else if (age >= 36 && age <= 40) {
                return "36-40";
            }
        }
        $("#btndonedit").on('click', function(){
            var newname = document.getElementById("customerNameEdit").value;
            var newphone = document.getElementById("customerPhoneEdit").value;
            var newaddress = document.getElementById("customerAddressEdit").value;
            if((newname=="" || newname==null)&&(newphone=="" || newphone==null)&&(newaddress==null || newaddress=="")){
                alert("No information was changed!")
            }
            else {
                $.ajax({
                    url: "http://0.0.0.0:8855/editcustomer",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        "cusname": newname, "cusphone": newphone, "cusaddress": newaddress, "cusid": clickid
                    }),
                    success: function (data) {
                        alert(data);
                        $("#modalEdit").modal("hide");
                    }
                });
            }
        });
    </script>
</body>